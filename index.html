<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Birdsong Field Analyzer Â· Neotech Field PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#050509" />
  <link rel="stylesheet" href="css/styles.css" />
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
  <script defer src="js/controls.js"></script>
  <script defer src="js/audio-prod.js"></script>
  <script defer src="js/network.js"></script>
  <script defer src="js/sw-register.js"></script>
</head>
<body class="theme-dark">
  <header class="top-bar">
    <div class="brand">
      <span class="brand-dot"></span>
      <span class="brand-text">Birdsong Field Analyzer Â· Neotech</span>
    </div>
    <nav class="inclusive-controls" aria-label="Controles de accesibilidad">
      <button class="ctrl-btn" id="btn-home" title="Inicio">ğŸ </button>
      <button class="ctrl-btn" id="btn-tts" title="Narrador">ğŸ—£ï¸</button>
      <button class="ctrl-btn" id="btn-theme" title="Tema claro/oscuro">ğŸŒ“</button>
      <button class="ctrl-btn" id="btn-font-plus" title="Aumentar tamaÃ±o de letra">A+</button>
      <button class="ctrl-btn" id="btn-font-minus" title="Disminuir tamaÃ±o de letra">Aâˆ’</button>
      <button class="ctrl-btn" id="btn-lang" title="Cambiar idioma ES/EN">ğŸŒ</button>
      <button class="ctrl-btn" id="btn-focus" title="Modo enfoque / reducir distracciÃ³n">ğŸ§ </button>
      <button class="ctrl-btn" id="btn-search" title="Buscar en el contenido">ğŸ”</button>
    </nav>
  </header>

  <main class="layout layout-3col">
    <!-- Panel 3D -->
    <section class="viz-panel" aria-label="Red 3D del canto de aves">
      <div id="three-container"></div>
      <div class="reel-caption" data-lang="es">
        <p>
          <span>VisualizaciÃ³n en vivo del ambiente sonoro.</span>
        </p>
        <p>
          <span class="accent">Cada nodo</span> representa un evento sonoro
          y <span class="accent">cada lÃ­nea</span> una transiciÃ³n en el tiempo.
        </p>
      </div>
      <div class="reel-caption hidden" data-lang="en">
        <p>
          <span>Live visualization of the soundscape.</span>
        </p>
        <p>
          <span class="accent">Each node</span> is a sound event
          and <span class="accent">each edge</span> a transition over time.
        </p>
      </div>
    </section>

    <!-- Panel central: audio en vivo -->
    <section class="info-panel">
      <h1 id="title-es">Modo terreno Â· AnÃ¡lisis local en el navegador</h1>
      <h1 id="title-en" class="hidden">Field mode Â· Local browser analysis</h1>

      <p class="lead" id="lead-es">
        Esta versiÃ³n funciona 100% en el navegador del celular. No requiere servidor externo:
        el micrÃ³fono se procesa en el dispositivo y genera la red 3D + estimaciones de banda y patrÃ³n.
        Es ideal como herramienta educativa y de exploraciÃ³n en terreno.
      </p>
      <p class="lead hidden" id="lead-en">
        This version runs 100% in the phone browser. No external server is required:
        the microphone is processed on-device to generate the 3D network and band/pattern estimates.
        It is meant as an educational and exploratory field tool.
      </p>

      <div class="section-card">
        <h2>Estado del audio</h2>
        <p id="audio-status">ğŸ™ï¸ Pulsa â€œIniciar escuchaâ€ para comenzar.</p>
        <div class="horizontal-buttons">
          <button class="action-btn" id="btn-start-audio">â–¶ï¸ Iniciar escucha</button>
          <button class="action-btn secondary" id="btn-stop-audio">â¸ï¸ Detener</button>
        </div>
        <div class="level-bar-wrapper">
          <div class="level-bar" id="level-bar"></div>
        </div>
        <small id="hint-es">
          Consejo: acÃ©rcate a un Ã¡rbol o zona con aves, mantÃ©n el telÃ©fono quieto y evita hablar mientras grabas.
        </small>
        <small id="hint-en" class="hidden">
          Tip: move closer to a tree or bird area, keep the phone still and avoid speaking while recording.
        </small>
      </div>

      <div class="section-card">
        <h2>SesiÃ³n actual</h2>
        <p id="session-summary">
          â±ï¸ DuraciÃ³n: 0 s Â· ğŸ”¹ Eventos detectados: 0 Â· ğŸ”— Transiciones: 0
        </p>
        <button class="action-btn secondary full-width" id="btn-reset-session">â™»ï¸ Reiniciar sesiÃ³n</button>
      </div>

      <div class="section-card">
        <h2>Exportar datos</h2>
        <p>Descarga un CSV con los eventos detectados, banda dominante y especie aproximada sugerida.</p>
        <button class="action-btn full-width" id="btn-download-csv">ğŸ“¥ Descargar CSV</button>
      </div>
    </section>

    <!-- Panel derecho: especies -->
    <aside class="info-panel">
      <h2 id="species-title-es">EstimaciÃ³n local de especies (heurÃ­stica)</h2>
      <h2 id="species-title-en" class="hidden">Local species estimation (heuristic)</h2>

      <p id="species-intro-es" class="lead">
        El sistema analiza la energÃ­a en tres bandas de frecuencia y el patrÃ³n relativo entre ellas.
        Usa firmas simples para sugerir algunas especies comunes de Chile. No es un identificador cientÃ­fico,
        sino una herramienta didÃ¡ctica. Puedes conectar mÃ¡s adelante un backend BirdNET opcional.
      </p>
      <p id="species-intro-en" class="lead hidden">
        The system analyzes energy in three frequency bands and their relative pattern.
        It uses simple signatures to suggest a few common Chilean species. It is not a scientific identifier,
        but an educational tool. You may later attach an optional BirdNET backend if desired.
      </p>

      <div class="section-card">
        <h3>Especie sugerida</h3>
        <p id="species-current">ğŸ•Šï¸ Esperando audio...</p>
        <ul id="species-list" class="species-list"></ul>
      </div>

      <div class="section-card">
        <h3>Modos de uso</h3>
        <ul class="mode-list">
          <li><strong>Offline:</strong> funciona en PWA, Ãºtil para salidas a terreno con mala seÃ±al.</li>
          <li><strong>Online + backend:</strong> el archivo <code>audio-prod.js</code> deja un hook para conectar BirdNET u otro servicio.</li>
        </ul>
      </div>

      <div class="section-card">
        <h3>Otras vistas</h3>
        <div class="action-buttons">
          <a class="action-btn" href="viewer3D/index.html">ğŸ‘ï¸ 3D Viewer</a>
          <button class="action-btn disabled">ğŸ“± AR (prÃ³ximamente)</button>
          <button class="action-btn disabled">ğŸ¥½ VR (prÃ³ximamente)</button>
          <button class="action-btn disabled">ğŸ§ª Quiz</button>
          <button class="action-btn disabled">ğŸŸï¸ Ticket</button>
        </div>
      </div>
    </aside>
  </main>

  <footer class="footer">
    <p>
      Birdsong Field Analyzer Â· Neotech EduLab Â· Funciona en celular como PWA Â· Uso educativo / exploratorio.
    </p>
  </footer>
</body>
</html>
