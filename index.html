<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Birdsong Field Analyzer Â· Pancho Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="css/styles.css" />
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
  <script defer src="js/controls.js"></script>
  <script defer src="js/audio.js"></script>
  <script defer src="js/network.js"></script>
  <script defer src="js/sw-register.js"></script>
</head>
<body class="theme-dark">
  <header class="top-bar">
    <div class="brand">
      <span class="brand-dot"></span>
      <span class="brand-text">Birdsong Field Analyzer Â· Pancho Edition</span>
    </div>
    <nav class="inclusive-controls" aria-label="Controles de accesibilidad">
      <button class="ctrl-btn" id="btn-home" title="Inicio">ğŸ </button>
      <button class="ctrl-btn" id="btn-tts" title="Narrador">ğŸ—£ï¸</button>
      <button class="ctrl-btn" id="btn-theme" title="Tema claro/oscuro">ğŸŒ“</button>
      <button class="ctrl-btn" id="btn-font-plus" title="Aumentar tamaÃ±o de letra">A+</button>
      <button class="ctrl-btn" id="btn-font-minus" title="Disminuir tamaÃ±o de letra">Aâˆ’</button>
      <button class="ctrl-btn" id="btn-lang" title="Cambiar idioma ES/EN">ğŸŒ</button>
      <button class="ctrl-btn" id="btn-focus" title="Modo enfoque / reducir distracciÃ³n">ğŸ§ </button>
      <button class="ctrl-btn" id="btn-search" title="Buscar en el contenido">ğŸ”</button>
    </nav>
  </header>

  <main class="layout layout-3col">
    <!-- Panel 3D -->
    <section class="viz-panel" aria-label="Red 3D del canto de aves">
      <div id="three-container"></div>
      <div class="reel-caption" data-lang="es">
        <p>
          <span>VisualizaciÃ³n en vivo del canto capturado en terreno.</span>
        </p>
        <p>
          <span class="accent">Cada nodo</span> es una sÃ­laba detectada y
          <span class="accent">cada lÃ­nea</span> una transiciÃ³n en el canto.
        </p>
      </div>
      <div class="reel-caption hidden" data-lang="en">
        <p>
          <span>Live visualization of the song captured in the field.</span>
        </p>
        <p>
          <span class="accent">Each node</span> is a detected syllable and
          <span class="accent">each edge</span> a transition in the song.
        </p>
      </div>
    </section>

    <!-- Panel central: audio en vivo -->
    <section class="info-panel">
      <h1 id="title-es">Modo terreno Â· Captura de audio</h1>
      <h1 id="title-en" class="hidden">Field mode Â· Audio capture</h1>

      <p class="lead" id="lead-es">
        Usa el micrÃ³fono del dispositivo para escuchar el entorno. El analizador extrae
        patrones bÃ¡sicos (energÃ­a, bandas de frecuencia) y alimenta la red 3D. Esta versiÃ³n
        es un prototipo educativo: la detecciÃ³n de especies es aproximada y estÃ¡ pensada para
        experimentaciÃ³n, no para investigaciÃ³n profesional.
      </p>
      <p class="lead hidden" id="lead-en">
        Uses the device microphone to listen to the environment. The analyzer extracts basic
        patterns (energy, frequency bands) and feeds the 3D network. This version is an
        educational prototype: species detection is approximate and meant for exploration,
        not professional research.
      </p>

      <div class="section-card">
        <h2>Estado del audio</h2>
        <p id="audio-status">ğŸ™ï¸ Pulsa â€œIniciar escuchaâ€ para comenzar.</p>
        <button class="action-btn" id="btn-start-audio">â–¶ï¸ Iniciar escucha</button>
        <button class="action-btn secondary" id="btn-stop-audio">â¸ï¸ Detener</button>
        <div class="level-bar-wrapper">
          <div class="level-bar" id="level-bar"></div>
        </div>
        <small id="hint-es">
          Consejo: acÃ©rcate a un Ã¡rbol o zona con aves, mantÃ©n el telÃ©fono quieto y evita hablar mientras grabas.
        </small>
        <small id="hint-en" class="hidden">
          Tip: move closer to a tree or bird area, keep the phone still and avoid speaking while recording.
        </small>
      </div>

      <div class="section-card">
        <h2>SesiÃ³n actual</h2>
        <p id="session-summary">
          â±ï¸ DuraciÃ³n: 0 s Â· ğŸ”¹ SÃ­labas estimadas: 0 Â· ğŸ”— Transiciones: 0
        </p>
        <button class="action-btn secondary" id="btn-reset-session">â™»ï¸ Reiniciar sesiÃ³n</button>
      </div>

      <div class="section-card">
        <h2>Exportar datos</h2>
        <p>Cuando termines la sesiÃ³n puedes descargar un CSV con las sÃ­labas estimadas y la especie sugerida.</p>
        <button class="action-btn" id="btn-download-csv">ğŸ“¥ Descargar CSV</button>
      </div>
    </section>

    <!-- Panel derecho: especies -->
    <aside class="info-panel">
      <h2 id="species-title-es">DetecciÃ³n aproximada de especies</h2>
      <h2 id="species-title-en" class="hidden">Approximate species detection</h2>

      <p id="species-intro-es" class="lead">
        El algoritmo agrupa energÃ­a en bandas de frecuencia y ritmo y compara con un
        pequeÃ±o banco local de patrones. Es sÃ³lo una <strong>estimaciÃ³n educativa</strong>.
        Para trabajo serio, conecta este front-end a BirdNET u otro modelo profesional.
      </p>
      <p id="species-intro-en" class="lead hidden">
        The algorithm groups energy in frequency bands and rhythm and compares it with
        a small local pattern bank. It is only an <strong>educational estimate</strong>.
        For serious work, connect this front-end to BirdNET or another professional model.
      </p>

      <div class="section-card">
        <h3>Especie sugerida (demo local)</h3>
        <p id="species-current">ğŸ•Šï¸ Esperando audio...</p>
        <ul id="species-list" class="species-list"></ul>
      </div>

      <div class="section-card">
        <h3>Modo de inferencia</h3>
        <p>
          Esta versiÃ³n incluye sÃ³lo heurÃ­sticas locales y un â€œdemo aleatorio
          controladoâ€ para probar la interfaz.
        </p>
        <ul class="mode-list">
          <li><strong>Local demo:</strong> usa energÃ­a y rango de frecuencias para sugerir especies tÃ­picas.</li>
          <li><strong>API externa (BirdNET):</strong> deja lista la funciÃ³n <code>sendToExternalAPI()</code> para conectar un backend futuro.</li>
        </ul>
      </div>

      <div class="section-card">
        <h3>Otras vistas</h3>
        <div class="action-buttons">
          <a class="action-btn" href="viewer3D/index.html">ğŸ‘ï¸ 3D Viewer</a>
          <button class="action-btn disabled">ğŸ“± AR (prÃ³ximamente)</button>
          <button class="action-btn disabled">ğŸ¥½ VR (prÃ³ximamente)</button>
          <button class="action-btn disabled">ğŸ§ª Quiz</button>
          <button class="action-btn disabled">ğŸŸï¸ Ticket</button>
        </div>
      </div>
    </aside>
  </main>

  <footer class="footer">
    <p>
      Prototipo educativo para explorar canto de aves en terreno Â· Neotech EduLab Â·
      Sugerencias de especies aproximadas Â· Para uso profesional conecta BirdNET u otro backend.
    </p>
  </footer>
</body>
</html>
